<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>공지관리 시스템 DB 설계서 (v1.3)</title>
<style>
  body { font-family: -apple-system,BlinkMacSystemFont,'Segoe UI','Malgun Gothic',sans-serif; background:#f6f7fb; color:#111; margin:0; }
  .container { max-width: 1120px; margin: 24px auto; padding: 0 16px 52px; }
  .card { background:#fff; border:1px solid #e6e8f0; border-radius:14px; padding:20px 22px; box-shadow:0 6px 18px rgba(16,24,40,.06); margin:14px 0; }
  h1 { margin: 6px 0 4px; font-size: 24px; }
  h2 { margin: 0 0 10px; font-size: 18px; }
  h3 { margin: 18px 0 8px; font-size: 15px; }
  .muted { color:#6b7280; font-size: 12px; }
  table { width:100%; border-collapse: collapse; font-size: 13px; }
  th, td { border:1px solid #e6e8f0; padding:10px; vertical-align: top; }
  th { background:#f3f5ff; font-weight:700; }
  code, pre { font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; }
  pre { background:#0b1020; color:#e8eaf2; padding:14px; border-radius:12px; overflow:auto; }
  .pill { display:inline-block; padding:3px 10px; border-radius:999px; background:#eef2ff; border:1px solid #dbe2ff; font-size:12px; }
  ul { margin: 8px 0 0 18px; }
  .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="muted">공지관리 시스템 (NoticeGate)</div>
    <h1>DB 설계서 <span class="pill">v1.3</span></h1>
    <div class="muted">작성자: 함윤식 · 작성일: 2026-01-02 · DBMS: PostgreSQL 15.15</div>
    <div class="muted">변경사항: (1) NOTICE_LEVEL만 ENUM 적용 (2) 인덱스 권장안 + 사유 추가</div>
  </div>

  <div class="card">
    <h2>문서 이력 (Version History)</h2>
    <table>
      <tr><th style="width:120px;">버전</th><th style="width:150px;">일자</th><th style="width:120px;">작성자</th><th>변경 내용</th></tr>
      <tr><td>v1.0</td><td>2026-01-02</td><td>함윤식</td><td>초안 작성(TB_* 네이밍)</td></tr>
      <tr><td>v1.1</td><td>2026-01-02</td><td>함윤식</td><td>테이블명 업무 구분(한글) 적용(공지_*)</td></tr>
      <tr><td>v1.2</td><td>2026-01-02</td><td>함윤식</td><td>테이블명 영문 도메인 네이밍 적용(NOTICE_*)</td></tr>
      <tr><td>v1.3</td><td>2026-01-02</td><td>함윤식</td><td>NOTICE_LEVEL ENUM 적용 + 인덱스 권장안 및 사유 추가</td></tr>
    </table>
  </div>

  <div class="card">
    <h2>ENUM 분리(vs VARCHAR 유지) 적용 내역</h2>
    <div class="grid">
      <div>
        <h3>적용 대상</h3>
        <ul>
          <li><b>NOTICE_LEVEL</b> 만 ENUM 적용</li>
          <li>그 외 상태/유형 값은 확장 가능성이 있어 VARCHAR 유지</li>
        </ul>
      </div>
      <div>
        <h3>적용 이유</h3>
        <ul>
          <li>NOTICE_LEVEL은 정책의 핵심(L1/L2/L3)으로 변경 가능성이 낮음</li>
          <li>오타/비정상 값 저장을 DB 차원에서 차단해야 함</li>
          <li>상태값(STATUS)은 향후 CANCELLED/EXPIRED 등 확장 가능성이 있어 VARCHAR 유지가 유리</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>전체 ERD (Mermaid)</h2>
    <div class="muted">VSCode Mermaid Preview에서 렌더링하여 확인</div>
    <pre><code>```mermaid
erDiagram
    NOTICE_BASE ||--o| NOTICE_APPROVAL : 승인
    NOTICE_BASE ||--o| NOTICE_SEND_PLAN : 발송계획
    NOTICE_BASE ||--o{ NOTICE_DELIVERY_LOG : 발송이력
    NOTICE_BASE ||--o{ NOTICE_CALENDAR_EVENT : 캘린더이벤트
    NOTICE_BASE ||--o{ NOTICE_TARGET : 수신대상
    NOTICE_BASE ||--o{ NOTICE_TAG : 해시태그
    NOTICE_BASE ||--o{ NOTICE_ATTACHMENT : 첨부파일

    NOTICE_BASE {
        BIGSERIAL NOTICE_ID PK "공지 ID"
        VARCHAR TITLE "공지 제목"
        TEXT CONTENT "공지 내용"
        NOTICE_LEVEL_ENUM NOTICE_LEVEL "공지 중요도"
        VARCHAR NOTICE_STATUS "공지 상태"
        VARCHAR SENDER_ORG_UNIT_ID "발신 부서 ID"
        VARCHAR SENDER_ORG_UNIT_NAME "발신 부서명"
        TIMESTAMP PUBLISH_START_AT "게시 시작"
        TIMESTAMP PUBLISH_END_AT "게시 종료"
        BOOLEAN IS_MAINTENANCE "점검/장애 여부"
        BOOLEAN IS_COMPLETED "완료 여부"
        TIMESTAMP COMPLETED_AT "완료 일시"
        VARCHAR MAIL_SUBJECT "메일/캘린더 제목"
        TIMESTAMP CREATED_AT "등록 일시"
        VARCHAR CREATED_BY "등록자"
        TIMESTAMP UPDATED_AT "수정 일시"
        VARCHAR UPDATED_BY "수정자"
    }

    NOTICE_APPROVAL {
        BIGSERIAL APPROVAL_ID PK "승인 ID"
        BIGINT NOTICE_ID FK "공지 ID"
        VARCHAR APPROVAL_STATUS "승인 상태"
        VARCHAR APPROVER_USER_ID "승인자 ID"
        VARCHAR APPROVER_NAME "승인자 이름"
        TIMESTAMP REQUESTED_AT "요청 일시"
        TIMESTAMP DECIDED_AT "처리 일시"
        VARCHAR REJECT_REASON "반려 사유"
    }

    NOTICE_SEND_PLAN {
        BIGSERIAL SEND_PLAN_ID PK "발송 계획 ID"
        BIGINT NOTICE_ID FK "공지 ID"
        VARCHAR SEND_MODE "발송 방식"
        TIMESTAMP SCHEDULED_SEND_AT "예약 발송"
        VARCHAR BUNDLE_KEY "묶음 키"
        BOOLEAN ALLOW_BUNDLE "묶음 허용"
    }

    NOTICE_DELIVERY_LOG {
        BIGSERIAL DELIVERY_ID PK "발송 이력 ID"
        BIGINT NOTICE_ID FK "공지 ID"
        VARCHAR CHANNEL "발송 채널"
        VARCHAR DELIVERY_STATUS "발송 상태"
        TIMESTAMP SENT_AT "발송 일시"
        INT ATTEMPT_COUNT "시도 횟수"
        TEXT LAST_ERROR "오류 내용"
        VARCHAR PROVIDER_MESSAGE_ID "외부 메시지 ID"
        VARCHAR IDEMPOTENCY_KEY "중복 방지 키"
    }

    NOTICE_CALENDAR_EVENT {
        BIGSERIAL CALENDAR_EVENT_ID PK "캘린더 이벤트 ID"
        BIGINT NOTICE_ID FK "공지 ID"
        VARCHAR RESOURCE_MAILBOX "자원 메일"
        VARCHAR PROVIDER_EVENT_ID "외부 이벤트 ID"
        TIMESTAMP CREATED_AT "등록 일시"
    }

    NOTICE_TARGET {
        BIGSERIAL TARGET_ID PK "대상 ID"
        BIGINT NOTICE_ID FK "공지 ID"
        VARCHAR TARGET_TYPE "대상 유형"
        VARCHAR TARGET_KEY "대상 키"
        VARCHAR TARGET_NAME "대상 명칭"
    }

    NOTICE_TAG {
        BIGSERIAL TAG_ID PK "태그 ID"
        BIGINT NOTICE_ID FK "공지 ID"
        VARCHAR TAG_VALUE "해시태그"
    }

    NOTICE_ATTACHMENT {
        BIGSERIAL ATTACHMENT_ID PK "첨부 ID"
        BIGINT NOTICE_ID FK "공지 ID"
        VARCHAR FILE_NAME "파일명"
        BIGINT SIZE_BYTES "파일 크기"
        VARCHAR STORAGE_KEY "저장 키"
    }

```</code></pre>
  </div>

  <div class="card">
    <h2>DDL: 테이블 + ENUM</h2>
    <pre><code>-- =====================================================
-- NoticeGate 공지관리 시스템 DDL (PostgreSQL 15.15)
-- 작성자 : 함윤식
-- 버전   : v1.3 (NOTICE_LEVEL만 ENUM 적용 + 인덱스 추가)
-- =====================================================

BEGIN;

-- 0) ENUM 타입 (NOTICE_LEVEL만 고정 정책 값으로 판단하여 ENUM 적용)
DO $$ BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'notice_level_enum') THEN
        CREATE TYPE NOTICE_LEVEL_ENUM AS ENUM ('L1', 'L2', 'L3');
    END IF;
END $$;

-- 1) NOTICE_BASE (공지 기본)
CREATE TABLE IF NOT EXISTS NOTICE_BASE (
    NOTICE_ID            BIGSERIAL PRIMARY KEY,
    TITLE                VARCHAR(200) NOT NULL,
    CONTENT              TEXT NOT NULL,
    NOTICE_LEVEL         NOTICE_LEVEL_ENUM NOT NULL, -- L1/L2/L3
    NOTICE_STATUS        VARCHAR(30) NOT NULL,       -- DRAFT/PENDING/APPROVED/SENT/FAILED/COMPLETED
    SENDER_ORG_UNIT_ID   VARCHAR(50),
    SENDER_ORG_UNIT_NAME VARCHAR(100),
    PUBLISH_START_AT     TIMESTAMP,
    PUBLISH_END_AT       TIMESTAMP,
    IS_MAINTENANCE       BOOLEAN NOT NULL DEFAULT FALSE,
    IS_COMPLETED         BOOLEAN NOT NULL DEFAULT FALSE,
    COMPLETED_AT         TIMESTAMP,
    MAIL_SUBJECT         VARCHAR(300),
    CREATED_AT           TIMESTAMP NOT NULL DEFAULT NOW(),
    CREATED_BY           VARCHAR(50) NOT NULL,
    UPDATED_AT           TIMESTAMP NOT NULL DEFAULT NOW(),
    UPDATED_BY           VARCHAR(50) NOT NULL
);

-- 2) NOTICE_APPROVAL (공지 1건당 0~1건)
CREATE TABLE IF NOT EXISTS NOTICE_APPROVAL (
    APPROVAL_ID        BIGSERIAL PRIMARY KEY,
    NOTICE_ID          BIGINT NOT NULL UNIQUE,
    APPROVAL_STATUS    VARCHAR(20) NOT NULL, -- PENDING/APPROVED/REJECTED
    APPROVER_USER_ID   VARCHAR(50),
    APPROVER_NAME      VARCHAR(100),
    REQUESTED_AT       TIMESTAMP NOT NULL DEFAULT NOW(),
    DECIDED_AT         TIMESTAMP,
    REJECT_REASON      VARCHAR(500),
    CONSTRAINT FK_NOTICE_APPROVAL
        FOREIGN KEY (NOTICE_ID) REFERENCES NOTICE_BASE (NOTICE_ID) ON DELETE CASCADE
);

-- 3) NOTICE_SEND_PLAN (공지 1건당 0~1건)
CREATE TABLE IF NOT EXISTS NOTICE_SEND_PLAN (
    SEND_PLAN_ID        BIGSERIAL PRIMARY KEY,
    NOTICE_ID           BIGINT NOT NULL UNIQUE,
    SEND_MODE           VARCHAR(20) NOT NULL, -- IMMEDIATE/SCHEDULED
    SCHEDULED_SEND_AT   TIMESTAMP,
    BUNDLE_KEY          VARCHAR(80),
    ALLOW_BUNDLE        BOOLEAN NOT NULL DEFAULT TRUE,
    CONSTRAINT FK_NOTICE_SEND_PLAN
        FOREIGN KEY (NOTICE_ID) REFERENCES NOTICE_BASE (NOTICE_ID) ON DELETE CASCADE
);

-- 4) NOTICE_DELIVERY_LOG (공지 1건당 0~N)
CREATE TABLE IF NOT EXISTS NOTICE_DELIVERY_LOG (
    DELIVERY_ID         BIGSERIAL PRIMARY KEY,
    NOTICE_ID           BIGINT NOT NULL,
    CHANNEL             VARCHAR(30) NOT NULL DEFAULT 'OUTLOOK_MAIL',
    DELIVERY_STATUS     VARCHAR(20) NOT NULL, -- READY/SENT/FAILED
    SENT_AT             TIMESTAMP,
    ATTEMPT_COUNT       INT NOT NULL DEFAULT 0,
    LAST_ERROR          TEXT,
    PROVIDER_MESSAGE_ID VARCHAR(120),
    IDEMPOTENCY_KEY     VARCHAR(80),
    CONSTRAINT FK_NOTICE_DELIVERY
        FOREIGN KEY (NOTICE_ID) REFERENCES NOTICE_BASE (NOTICE_ID) ON DELETE CASCADE
);

-- 5) NOTICE_CALENDAR_EVENT (공지 1건당 0~N)
CREATE TABLE IF NOT EXISTS NOTICE_CALENDAR_EVENT (
    CALENDAR_EVENT_ID   BIGSERIAL PRIMARY KEY,
    NOTICE_ID           BIGINT NOT NULL,
    RESOURCE_MAILBOX    VARCHAR(120) NOT NULL,
    PROVIDER_EVENT_ID   VARCHAR(120) NOT NULL,
    CREATED_AT          TIMESTAMP NOT NULL DEFAULT NOW(),
    CONSTRAINT FK_NOTICE_CALENDAR_EVENT
        FOREIGN KEY (NOTICE_ID) REFERENCES NOTICE_BASE (NOTICE_ID) ON DELETE CASCADE
);

-- 6) NOTICE_TARGET (공지 1건당 0~N)
CREATE TABLE IF NOT EXISTS NOTICE_TARGET (
    TARGET_ID       BIGSERIAL PRIMARY KEY,
    NOTICE_ID       BIGINT NOT NULL,
    TARGET_TYPE     VARCHAR(20) NOT NULL, -- CORP/ORG_UNIT/USER/SERVICE
    TARGET_KEY      VARCHAR(80) NOT NULL,
    TARGET_NAME     VARCHAR(200),
    CONSTRAINT FK_NOTICE_TARGET
        FOREIGN KEY (NOTICE_ID) REFERENCES NOTICE_BASE (NOTICE_ID) ON DELETE CASCADE
);

-- 7) NOTICE_TAG (공지 1건당 0~N)
CREATE TABLE IF NOT EXISTS NOTICE_TAG (
    TAG_ID      BIGSERIAL PRIMARY KEY,
    NOTICE_ID   BIGINT NOT NULL,
    TAG_VALUE   VARCHAR(50) NOT NULL,
    CONSTRAINT FK_NOTICE_TAG
        FOREIGN KEY (NOTICE_ID) REFERENCES NOTICE_BASE (NOTICE_ID) ON DELETE CASCADE
);

-- 8) NOTICE_ATTACHMENT (공지 1건당 0~N)
CREATE TABLE IF NOT EXISTS NOTICE_ATTACHMENT (
    ATTACHMENT_ID   BIGSERIAL PRIMARY KEY,
    NOTICE_ID       BIGINT NOT NULL,
    FILE_NAME       VARCHAR(255) NOT NULL,
    SIZE_BYTES      BIGINT NOT NULL,
    STORAGE_KEY     VARCHAR(300) NOT NULL,
    CONSTRAINT FK_NOTICE_ATTACHMENT
        FOREIGN KEY (NOTICE_ID) REFERENCES NOTICE_BASE (NOTICE_ID) ON DELETE CASCADE
);

COMMIT;
</code></pre>
  </div>

  <div class="card">
    <h2>DDL: 한글 코멘트(모든 컬럼)</h2>
    <pre><code>-- =====================================================
-- 한글 설명(코멘트)
-- =====================================================

COMMENT ON TABLE NOTICE_BASE IS '공지 기본 정보';
COMMENT ON COLUMN NOTICE_BASE.NOTICE_ID IS '공지 고유 식별자(PK)';
COMMENT ON COLUMN NOTICE_BASE.TITLE IS '공지 제목';
COMMENT ON COLUMN NOTICE_BASE.CONTENT IS '공지 상세 내용';
COMMENT ON COLUMN NOTICE_BASE.NOTICE_LEVEL IS '공지 중요도(ENUM: L1 일반, L2 중요, L3 긴급)';
COMMENT ON COLUMN NOTICE_BASE.NOTICE_STATUS IS '공지 상태(DRAFT, PENDING, APPROVED, SENT, FAILED, COMPLETED)';
COMMENT ON COLUMN NOTICE_BASE.SENDER_ORG_UNIT_ID IS '발신 부서 ID';
COMMENT ON COLUMN NOTICE_BASE.SENDER_ORG_UNIT_NAME IS '발신 부서명';
COMMENT ON COLUMN NOTICE_BASE.PUBLISH_START_AT IS '게시 시작 일시';
COMMENT ON COLUMN NOTICE_BASE.PUBLISH_END_AT IS '게시 종료 일시';
COMMENT ON COLUMN NOTICE_BASE.IS_MAINTENANCE IS '점검/장애 공지 여부';
COMMENT ON COLUMN NOTICE_BASE.IS_COMPLETED IS '완료 처리 여부';
COMMENT ON COLUMN NOTICE_BASE.COMPLETED_AT IS '완료 처리 일시';
COMMENT ON COLUMN NOTICE_BASE.MAIL_SUBJECT IS '메일 및 캘린더 일정 제목';
COMMENT ON COLUMN NOTICE_BASE.CREATED_AT IS '등록 일시';
COMMENT ON COLUMN NOTICE_BASE.CREATED_BY IS '등록자';
COMMENT ON COLUMN NOTICE_BASE.UPDATED_AT IS '수정 일시';
COMMENT ON COLUMN NOTICE_BASE.UPDATED_BY IS '수정자';

COMMENT ON TABLE NOTICE_APPROVAL IS '공지 승인 정보';
COMMENT ON COLUMN NOTICE_APPROVAL.APPROVAL_ID IS '승인 고유 식별자(PK)';
COMMENT ON COLUMN NOTICE_APPROVAL.NOTICE_ID IS '승인 대상 공지 ID(FK, 공지 1건당 0~1건)';
COMMENT ON COLUMN NOTICE_APPROVAL.APPROVAL_STATUS IS '승인 상태(PENDING, APPROVED, REJECTED)';
COMMENT ON COLUMN NOTICE_APPROVAL.APPROVER_USER_ID IS '승인자 사용자 ID';
COMMENT ON COLUMN NOTICE_APPROVAL.APPROVER_NAME IS '승인자 이름';
COMMENT ON COLUMN NOTICE_APPROVAL.REQUESTED_AT IS '승인 요청 일시';
COMMENT ON COLUMN NOTICE_APPROVAL.DECIDED_AT IS '승인/반려 처리 일시';
COMMENT ON COLUMN NOTICE_APPROVAL.REJECT_REASON IS '반려 사유';

COMMENT ON TABLE NOTICE_SEND_PLAN IS '공지 발송 계획';
COMMENT ON COLUMN NOTICE_SEND_PLAN.SEND_PLAN_ID IS '발송 계획 고유 식별자(PK)';
COMMENT ON COLUMN NOTICE_SEND_PLAN.NOTICE_ID IS '발송 대상 공지 ID(FK, 공지 1건당 0~1건)';
COMMENT ON COLUMN NOTICE_SEND_PLAN.SEND_MODE IS '발송 방식(IMMEDIATE:즉시, SCHEDULED:예약)';
COMMENT ON COLUMN NOTICE_SEND_PLAN.SCHEDULED_SEND_AT IS '예약 발송 일시';
COMMENT ON COLUMN NOTICE_SEND_PLAN.BUNDLE_KEY IS '묶음 발송 기준 키';
COMMENT ON COLUMN NOTICE_SEND_PLAN.ALLOW_BUNDLE IS '묶음 발송 허용 여부';

COMMENT ON TABLE NOTICE_DELIVERY_LOG IS '공지 발송 이력';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.DELIVERY_ID IS '발송 이력 고유 식별자(PK)';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.NOTICE_ID IS '발송 대상 공지 ID(FK)';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.CHANNEL IS '발송 채널(기본 OUTLOOK_MAIL)';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.DELIVERY_STATUS IS '발송 상태(READY, SENT, FAILED)';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.SENT_AT IS '발송 완료 일시';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.ATTEMPT_COUNT IS '발송 시도 횟수';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.LAST_ERROR IS '최종 오류 내용';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.PROVIDER_MESSAGE_ID IS '외부 발송 시스템 메시지 ID';
COMMENT ON COLUMN NOTICE_DELIVERY_LOG.IDEMPOTENCY_KEY IS '중복 발송 방지 키';

COMMENT ON TABLE NOTICE_CALENDAR_EVENT IS '공지 캘린더 일정 연계';
COMMENT ON COLUMN NOTICE_CALENDAR_EVENT.CALENDAR_EVENT_ID IS '캘린더 이벤트 고유 식별자(PK)';
COMMENT ON COLUMN NOTICE_CALENDAR_EVENT.NOTICE_ID IS '연계 대상 공지 ID(FK)';
COMMENT ON COLUMN NOTICE_CALENDAR_EVENT.RESOURCE_MAILBOX IS '공지 자원 메일 주소';
COMMENT ON COLUMN NOTICE_CALENDAR_EVENT.PROVIDER_EVENT_ID IS '외부 캘린더 이벤트 ID';
COMMENT ON COLUMN NOTICE_CALENDAR_EVENT.CREATED_AT IS '캘린더 등록 일시';

COMMENT ON TABLE NOTICE_TARGET IS '공지 수신 대상';
COMMENT ON COLUMN NOTICE_TARGET.TARGET_ID IS '수신 대상 고유 식별자(PK)';
COMMENT ON COLUMN NOTICE_TARGET.NOTICE_ID IS '공지 ID(FK)';
COMMENT ON COLUMN NOTICE_TARGET.TARGET_TYPE IS '대상 유형(CORP/ORG_UNIT/USER/SERVICE)';
COMMENT ON COLUMN NOTICE_TARGET.TARGET_KEY IS '대상 식별 키';
COMMENT ON COLUMN NOTICE_TARGET.TARGET_NAME IS '대상 표시명';

COMMENT ON TABLE NOTICE_TAG IS '공지 해시태그';
COMMENT ON COLUMN NOTICE_TAG.TAG_ID IS '태그 고유 식별자(PK)';
COMMENT ON COLUMN NOTICE_TAG.NOTICE_ID IS '공지 ID(FK)';
COMMENT ON COLUMN NOTICE_TAG.TAG_VALUE IS '해시태그 값';

COMMENT ON TABLE NOTICE_ATTACHMENT IS '공지 첨부 파일 메타데이터';
COMMENT ON COLUMN NOTICE_ATTACHMENT.ATTACHMENT_ID IS '첨부 파일 고유 식별자(PK)';
COMMENT ON COLUMN NOTICE_ATTACHMENT.NOTICE_ID IS '공지 ID(FK)';
COMMENT ON COLUMN NOTICE_ATTACHMENT.FILE_NAME IS '파일명';
COMMENT ON COLUMN NOTICE_ATTACHMENT.SIZE_BYTES IS '파일 크기(Byte)';
COMMENT ON COLUMN NOTICE_ATTACHMENT.STORAGE_KEY IS '저장소 경로/키';
</code></pre>
  </div>

  <div class="card">
    <h2>인덱스 권장안</h2>
    <div class="muted">※ UNIQUE 제약은 내부적으로 인덱스를 생성하지만, 운영/리뷰 용도로 명시적으로 “권장 인덱스 목록”을 정리</div>
    <table>
      <tr>
        <th style="width:220px;">인덱스명</th>
        <th style="width:220px;">대상(테이블/컬럼)</th>
        <th>사유</th>
      </tr>
<tr><td>IDX_NOTICE_DELIVERY_LOG_NOTICE_ID</td><td>NOTICE_DELIVERY_LOG (NOTICE_ID)</td><td>공지 상세 조회 시 발송이력을 NOTICE_ID로 조인/필터링하는 빈도가 높음</td></tr>
<tr><td>IDX_NOTICE_CALENDAR_EVENT_NOTICE_ID</td><td>NOTICE_CALENDAR_EVENT (NOTICE_ID)</td><td>캘린더 연계 이벤트를 공지 기준으로 조회/정리(재등록 이력 포함)</td></tr>
<tr><td>IDX_NOTICE_TARGET_NOTICE_ID</td><td>NOTICE_TARGET (NOTICE_ID)</td><td>공지 상세에서 수신대상 목록을 빠르게 조회</td></tr>
<tr><td>IDX_NOTICE_TAG_NOTICE_ID</td><td>NOTICE_TAG (NOTICE_ID)</td><td>공지 상세에서 해시태그 목록을 빠르게 조회</td></tr>
<tr><td>IDX_NOTICE_ATTACHMENT_NOTICE_ID</td><td>NOTICE_ATTACHMENT (NOTICE_ID)</td><td>공지 상세에서 첨부파일 목록을 빠르게 조회</td></tr>
<tr><td>IDX_NOTICE_BASE_PUBLISH_RANGE</td><td>NOTICE_BASE (PUBLISH_START_AT, PUBLISH_END_AT)</td><td>캘린더 월/주/일 조회 시 기간 조건 검색(범위 필터)</td></tr>
<tr><td>IDX_NOTICE_BASE_STATUS</td><td>NOTICE_BASE (NOTICE_STATUS)</td><td>대시보드에서 상태별(승인대기/발송예정/실패/완료) 집계/필터</td></tr>
<tr><td>IDX_NOTICE_BASE_LEVEL</td><td>NOTICE_BASE (NOTICE_LEVEL)</td><td>캘린더/목록에서 중요도별 색상/필터 적용</td></tr>
<tr><td>IDX_NOTICE_BASE_MAINT_COMPLETED</td><td>NOTICE_BASE (IS_MAINTENANCE, IS_COMPLETED)</td><td>점검/장애 공지와 완료 처리 공지(녹색) 필터링</td></tr>
<tr><td>IDX_NOTICE_BASE_SENDER_ORG</td><td>NOTICE_BASE (SENDER_ORG_UNIT_ID)</td><td>부서별 공지 발신 현황/검색(대시보드/리포트)</td></tr>
<tr><td>IDX_NOTICE_BASE_CREATED_AT</td><td>NOTICE_BASE (CREATED_AT DESC)</td><td>최근 공지 목록/정렬 성능 개선</td></tr>
<tr><td>IDX_NOTICE_TARGET_TYPE_KEY</td><td>NOTICE_TARGET (TARGET_TYPE, TARGET_KEY)</td><td>특정 법인/부서/사용자/서비스에 해당하는 공지 목록 조회</td></tr>
<tr><td>IDX_NOTICE_TAG_VALUE</td><td>NOTICE_TAG (TAG_VALUE)</td><td>해시태그별 통계/목록 조회(대시보드)</td></tr>
<tr><td>UQ_NOTICE_DELIVERY_IDEMPOTENCY</td><td>NOTICE_DELIVERY_LOG (CHANNEL, IDEMPOTENCY_KEY)</td><td>중복 발송 방지: 동일 채널에서 같은 IDEMPOTENCY_KEY로 두 번 기록되지 않도록 강제(권장)</td></tr>
    </table>
    <h3>인덱스 생성 SQL</h3>
    <pre><code>-- =====================================================
-- 인덱스/제약 (권장)
-- =====================================================
CREATE INDEX IF NOT EXISTS IDX_NOTICE_DELIVERY_LOG_NOTICE_ID ON NOTICE_DELIVERY_LOG (NOTICE_ID);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_CALENDAR_EVENT_NOTICE_ID ON NOTICE_CALENDAR_EVENT (NOTICE_ID);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_TARGET_NOTICE_ID ON NOTICE_TARGET (NOTICE_ID);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_TAG_NOTICE_ID ON NOTICE_TAG (NOTICE_ID);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_ATTACHMENT_NOTICE_ID ON NOTICE_ATTACHMENT (NOTICE_ID);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_BASE_PUBLISH_RANGE ON NOTICE_BASE (PUBLISH_START_AT, PUBLISH_END_AT);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_BASE_STATUS ON NOTICE_BASE (NOTICE_STATUS);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_BASE_LEVEL ON NOTICE_BASE (NOTICE_LEVEL);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_BASE_MAINT_COMPLETED ON NOTICE_BASE (IS_MAINTENANCE, IS_COMPLETED);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_BASE_SENDER_ORG ON NOTICE_BASE (SENDER_ORG_UNIT_ID);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_BASE_CREATED_AT ON NOTICE_BASE (CREATED_AT DESC);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_TARGET_TYPE_KEY ON NOTICE_TARGET (TARGET_TYPE, TARGET_KEY);
CREATE INDEX IF NOT EXISTS IDX_NOTICE_TAG_VALUE ON NOTICE_TAG (TAG_VALUE);
CREATE UNIQUE INDEX IF NOT EXISTS UQ_NOTICE_DELIVERY_IDEMPOTENCY ON NOTICE_DELIVERY_LOG (CHANNEL, IDEMPOTENCY_KEY);
</code></pre>
  </div>

  <div class="card">
    <h2>운영 적용 순서(권장)</h2>
    <ol>
      <li>DDL(ENUM + TABLE) 실행</li>
      <li>COMMENT 실행</li>
      <li>INDEX/UNIQUE INDEX 실행</li>
      <li>샘플 데이터 입력 후 캘린더/대시보드 조회 쿼리로 성능 확인</li>
    </ol>
  </div>
</div>
</body>
</html>
