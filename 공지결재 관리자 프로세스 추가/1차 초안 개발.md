# ê³µì§€ ë°œì†¡ ê²°ì¬ - ê´€ë¦¬ì ê¶Œí•œ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€

## ğŸ“‹ ê°œìš”

ê³µì§€ ë°œì†¡ ê²°ì¬ ì‹œìŠ¤í…œì— ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:

1. **ttlCd ê¸°ë°˜ ê¶Œí•œ ì²´í¬** (HR150138)
2. **ê¶Œí•œì— ë”°ë¥¸ ìŠ¹ì¸/ë°˜ë ¤ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”**
3. **ê´€ë¦¬ì ê¶Œí•œ ìœ„ì„ ê¸°ëŠ¥** (ëŒ€ë¦¬ ê´€ë¦¬ì ì§€ì •)
4. **ê°ì‚¬ ë¡œê·¸ ìë™ ê¸°ë¡**
5. **ë¡œê·¸ì¸ ì •ë³´ ì—†ìŒ ì—ëŸ¬ í‘œì‹œ**

---

## ğŸ—‚ï¸ íŒŒì¼ êµ¬ì¡°

```
ğŸ“¦ outputs/
â”œâ”€â”€ sql/
â”‚   â””â”€â”€ admin_delegation_and_audit_log.sql  # í…Œì´ë¸” DDL
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ AdminDelegation.java                 # ìœ„ì„ ì—”í‹°í‹°
â”‚   â”œâ”€â”€ AuditLog.java                        # ê°ì‚¬ ë¡œê·¸ ì—”í‹°í‹°
â”‚   â”œâ”€â”€ AdminDelegationRepository.java       # ìœ„ì„ ë ˆí¬ì§€í† ë¦¬
â”‚   â”œâ”€â”€ AuditLogRepository.java              # ë¡œê·¸ ë ˆí¬ì§€í† ë¦¬
â”‚   â”œâ”€â”€ AdminDelegationDto.java              # ìœ„ì„ DTO
â”‚   â”œâ”€â”€ AdminUserDto.java                    # ê´€ë¦¬ì ì‚¬ìš©ì DTO
â”‚   â”œâ”€â”€ AdminDelegationService.java          # ìœ„ì„ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ AuditLogService.java                 # ë¡œê·¸ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ AdminDelegationController.java       # ìœ„ì„ API ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â””â”€â”€ AdminUsersController.java            # ê´€ë¦¬ì ëª©ë¡ API ì»¨íŠ¸ë¡¤ëŸ¬
â””â”€â”€ frontend/
    â”œâ”€â”€ adminDelegationApi.js                # ìœ„ì„ API í´ë¼ì´ì–¸íŠ¸
    â”œâ”€â”€ adminUsersApi.js                     # ê´€ë¦¬ì API í´ë¼ì´ì–¸íŠ¸
    â”œâ”€â”€ AdminDelegationModal.jsx             # ê¶Œí•œ ìœ„ì„ íŒì—… ì»´í¬ë„ŒíŠ¸
    â”œâ”€â”€ AdminDelegationModal.css             # íŒì—… ìŠ¤íƒ€ì¼
    â”œâ”€â”€ NoticeApproval_updated.jsx           # ìˆ˜ì •ëœ ê²°ì¬ í™”ë©´
    â””â”€â”€ NoticeApproval_additional_styles.css # ì¶”ê°€ ìŠ¤íƒ€ì¼
```

---

## ğŸš€ ì„¤ì¹˜ ê°€ì´ë“œ

### 1ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

```bash
# PostgreSQLì— ì ‘ì†
psql -U postgres -d your_database

# DDL ì‹¤í–‰
\i sql/admin_delegation_and_audit_log.sql
```

**ìƒì„±ë˜ëŠ” í…Œì´ë¸”:**
- `admin_delegation` - ê´€ë¦¬ì ê¶Œí•œ ìœ„ì„ ì •ë³´
- `audit_log` - ì‹œìŠ¤í…œ ê°ì‚¬ ë¡œê·¸

---

### 2ï¸âƒ£ ë°±ì—”ë“œ íŒŒì¼ ë°°ì¹˜

#### ğŸ“ ì—”í‹°í‹° (Entity)
```
temp/data-temp/src/main/java/kr/co/koreazinc/temp/model/entity/admin/
â”œâ”€â”€ AdminDelegation.java
â””â”€â”€ AuditLog.java
```

#### ğŸ“ ë ˆí¬ì§€í† ë¦¬ (Repository)
```
temp/data-temp/src/main/java/kr/co/koreazinc/temp/repository/admin/
â”œâ”€â”€ AdminDelegationRepository.java
â””â”€â”€ AuditLogRepository.java
```

#### ğŸ“ DTO
```
temp/app-api/src/main/java/kr/co/koreazinc/app/dto/admin/
â”œâ”€â”€ AdminDelegationDto.java
â””â”€â”€ AdminUserDto.java
```

#### ğŸ“ ì„œë¹„ìŠ¤ (Service)
```
temp/app-api/src/main/java/kr/co/koreazinc/app/service/admin/
â”œâ”€â”€ AdminDelegationService.java
â””â”€â”€ AuditLogService.java
```

#### ğŸ“ ì»¨íŠ¸ë¡¤ëŸ¬ (Controller)
```
temp/app-api/src/main/java/kr/co/koreazinc/app/controller/v1/admin/
â”œâ”€â”€ AdminDelegationController.java
â””â”€â”€ AdminUsersController.java
```

---

### 3ï¸âƒ£ í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ ë°°ì¹˜

#### ğŸ“ API í´ë¼ì´ì–¸íŠ¸
```
temp/react-app/src/api/admin/
â”œâ”€â”€ adminDelegationApi.js
â””â”€â”€ adminUsersApi.js
```

**ì°¸ê³ **: `api/index.js`ì— ë‹¤ìŒ ë‚´ìš© ì¶”ê°€:
```javascript
// ê´€ë¦¬ì API
export { adminDelegationApi } from './admin/adminDelegationApi';
export { adminUsersApi } from './admin/adminUsersApi';
```

#### ğŸ“ ì»´í¬ë„ŒíŠ¸
```
temp/react-app/src/components/
â”œâ”€â”€ AdminDelegationModal.jsx
â””â”€â”€ AdminDelegationModal.css
```

#### ğŸ“ í˜ì´ì§€ (ê¸°ì¡´ íŒŒì¼ ëŒ€ì²´)
```
temp/react-app/src/pages/
â”œâ”€â”€ NoticeApproval.jsx  (â† NoticeApproval_updated.jsxë¡œ ëŒ€ì²´)
â””â”€â”€ NoticeApproval.css  (â† NoticeApproval_additional_styles.css ë‚´ìš© ì¶”ê°€)
```

**NoticeApproval.css ì—…ë°ì´íŠ¸ ë°©ë²•:**
- ê¸°ì¡´ `NoticeApproval.css` íŒŒì¼ ëì— `NoticeApproval_additional_styles.css` ë‚´ìš© ì¶”ê°€

---

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

### ê´€ë¦¬ì ê¶Œí•œ ìœ„ì„ API

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/v1/api/admin/delegations` | ê¶Œí•œ ìœ„ì„ ìƒì„± |
| GET | `/v1/api/admin/delegations/my` | ë‚´ ìœ„ì„ ëª©ë¡ ì¡°íšŒ |
| GET | `/v1/api/admin/delegations/current` | í˜„ì¬ ìœ íš¨í•œ ìœ„ì„ ì¡°íšŒ |
| DELETE | `/v1/api/admin/delegations/{id}` | ìœ„ì„ ë¹„í™œì„±í™” |

### ê´€ë¦¬ì ì‚¬ìš©ì API

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| GET | `/v1/api/admin/users?ttlCd=HR150138` | HR150138 ê¶Œí•œì ëª©ë¡ |
| GET | `/v1/api/admin/users/{userId}/permission` | ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ |

---

## ğŸ”‘ ê¶Œí•œ ì²´í¬ ë¡œì§

### 1. ì›ë˜ ê´€ë¦¬ì (ttlCd = HR150138)
```javascript
const ttlCd = userInfo.job?.[0]?.ttlCd;
const isAdmin = ttlCd === 'HR150138';
```

### 2. ëŒ€ë¦¬ ê´€ë¦¬ì (ê¶Œí•œ ìœ„ì„ ë°›ìŒ)
```javascript
const delegationResult = await adminDelegationApi.getCurrentDelegation();
if (delegationResult.success && delegationResult.data) {
  setIsDelegatedAdmin(true);
  setIsAdmin(true);
}
```

### 3. ìŠ¹ì¸ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
```jsx
<button 
  className={`btn-approve ${!isAdmin ? 'disabled' : ''}`}
  disabled={!isAdmin}
  title={!isAdmin ? 'ìŠ¹ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤ (HR150138 ê¶Œí•œ í•„ìš”)' : ''}
>
  ìŠ¹ì¸
</button>
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. **AdminUsersController ìƒ˜í”Œ ë°ì´í„°**
í˜„ì¬ `AdminUsersController.getSampleAdminUsers()` ë©”ì„œë“œëŠ” **í•˜ë“œì½”ë”©ëœ ìƒ˜í”Œ ë°ì´í„°**ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

**ì‹¤ì œ í™˜ê²½ ì ìš© ì‹œ:**
- SSO API í˜¸ì¶œë¡œ ëŒ€ì²´
- ë˜ëŠ” `user_master` í…Œì´ë¸” ì¡°ì¸ ì¡°íšŒ

### 2. **ì„¸ì…˜ìŠ¤í† ë¦¬ì§€ í‚¤**
í”„ë¡ íŠ¸ì—”ë“œëŠ” ë‹¤ìŒ í‚¤ì—ì„œ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤:
- `sessionStorage.getItem('userData')`
- `sessionStorage.getItem('user_me')`

### 3. **HTTP í—¤ë”**
ë°±ì—”ë“œ APIëŠ” ë‹¤ìŒ í—¤ë”ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤:
- `X-User-Id`: ì‚¬ìš©ì ID
- `X-User-Name`: ì‚¬ìš©ì ì´ë¦„

**Axios Interceptor ì„¤ì • í•„ìš”** (`apiClient.js`):
```javascript
apiClient.interceptors.request.use(config => {
  const userInfo = JSON.parse(sessionStorage.getItem('user_me'));
  if (userInfo) {
    config.headers['X-User-Id'] = userInfo.userId;
    config.headers['X-User-Name'] = userInfo.userNm;
  }
  return config;
});
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: HR150138 ê¶Œí•œì
1. HR150138 ê¶Œí•œìœ¼ë¡œ ë¡œê·¸ì¸
2. ìŠ¹ì¸ í™”ë©´ì—ì„œ "ê´€ë¦¬ì ê¶Œí•œ" ë°°ì§€ í™•ì¸
3. "ê¶Œí•œ ìœ„ì„" ë²„íŠ¼ í´ë¦­
4. ëŒ€ë¦¬ ê´€ë¦¬ì ì„ íƒ ë° ê¸°ê°„ ì„¤ì •
5. ìœ„ì„ ìƒì„± â†’ ê°ì‚¬ ë¡œê·¸ ê¸°ë¡ í™•ì¸

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì¼ë°˜ ì‚¬ìš©ì
1. ì¼ë°˜ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸
2. ìŠ¹ì¸ í™”ë©´ì—ì„œ ìŠ¹ì¸/ë°˜ë ¤ ë²„íŠ¼ ë¹„í™œì„±í™” í™•ì¸
3. ë²„íŠ¼ í˜¸ë²„ ì‹œ íˆ´íŒ "ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤" í‘œì‹œ í™•ì¸

### ì‹œë‚˜ë¦¬ì˜¤ 3: ëŒ€ë¦¬ ê´€ë¦¬ì
1. ìœ„ì„ë°›ì€ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸
2. ìŠ¹ì¸ í™”ë©´ì—ì„œ "ëŒ€ë¦¬ ê´€ë¦¬ì" ë°°ì§€ í™•ì¸
3. ìŠ¹ì¸/ë°˜ë ¤ ë²„íŠ¼ í™œì„±í™” í™•ì¸
4. ê³µì§€ ìŠ¹ì¸ â†’ ê°ì‚¬ ë¡œê·¸ì— ëŒ€ë¦¬ì ì •ë³´ ê¸°ë¡ í™•ì¸

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ERD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ admin_delegation    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK delegation_id    â”‚
â”‚    delegator_user_idâ”‚ (ìœ„ì„ì)
â”‚    delegate_user_id â”‚ (ëŒ€ë¦¬ì)
â”‚    start_date       â”‚
â”‚    end_date         â”‚
â”‚    reason           â”‚
â”‚    is_active        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ audit_log           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK log_id           â”‚
â”‚    log_type         â”‚ (ADMIN_DELEGATION, NOTICE_APPROVAL ë“±)
â”‚    action           â”‚ (CREATE, UPDATE, APPROVE ë“±)
â”‚    user_id          â”‚
â”‚    description      â”‚
â”‚    result           â”‚ (SUCCESS, FAILURE)
â”‚    created_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ì¶”ê°€ ê°œë°œ í•„ìš” ì‚¬í•­

1. **SSO API ì—°ë™** - AdminUsersControllerì˜ ìƒ˜í”Œ ë°ì´í„° ëŒ€ì²´
2. **Axios Interceptor** - HTTP í—¤ë” ìë™ ì¶”ê°€
3. **ê¶Œí•œ ì²´í¬ ê°•í™”** - ë°±ì—”ë“œì—ì„œë„ ttlCd ê²€ì¦
4. **ê°ì‚¬ ë¡œê·¸ ì¡°íšŒ í™”ë©´** - ê´€ë¦¬ììš© ë¡œê·¸ ì¡°íšŒ UI
5. **ì•Œë¦¼ ê¸°ëŠ¥** - ëŒ€ë¦¬ ê´€ë¦¬ì ì§€ì • ì‹œ ì´ë©”ì¼/ì•Œë¦¼ ë°œì†¡

---

## ğŸ‰ ì™„ë£Œ!

ëª¨ë“  íŒŒì¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¤ì¹˜ í›„ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

1. âœ… ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€
2. âœ… ë°±ì—”ë“œ ì»´íŒŒì¼ ì—ëŸ¬ê°€ ì—†ëŠ”ì§€
3. âœ… í”„ë¡ íŠ¸ì—”ë“œ import ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€
4. âœ… API ì—”ë“œí¬ì¸íŠ¸ê°€ ì •ìƒ ì‘ë‹µí•˜ëŠ”ì§€
5. âœ… ì„¸ì…˜ìŠ¤í† ë¦¬ì§€ì— ë¡œê·¸ì¸ ì •ë³´ê°€ ìˆëŠ”ì§€

**ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ë§ì”€í•´ì£¼ì„¸ìš”!** ğŸš€
