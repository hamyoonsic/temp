# 공지 발송 결재 - 관리자 권한 관리 기능 (v2 업데이트)

## 📋 변경 사항 (v2)

### ✅ **수정된 문제점**
1. **500 에러 해결**: `X-User-Id` 헤더 없을 때 샘플 데이터 반환
2. **UI 개선**: 관리자 권한 버튼 2개 → 1개로 통합
3. **헤더 표시**: 로그인 정보에 관리자 배지 추가

---

## 🎨 **주요 변경사항**

### 1️⃣ **백엔드 개선**
- **헤더 optional 처리**: `@RequestHeader(value = "X-User-Id", required = false)`
- **샘플 데이터 추가**: 헤더 없을 때 테스트용 데이터 반환
- **에러 방어 코드**: null 체크 및 기본값 설정

### 2️⃣ **프론트엔드 UI 개선**

#### **NoticeApproval.jsx**
- ✅ 기존 "관리자 권한" 배지 스타일 재사용
- ✅ "권한 위임" 버튼 → "관리자 위임" 버튼으로 통합
- ✅ 클릭 가능한 버튼으로 변경 (`clickable` 클래스)

**변경 전:**
```
[관리자 권한 배지] [권한 위임 버튼]
```

**변경 후:**
```
[관리자 위임 버튼] ← 클릭 시 모달 오픈
```

#### **AppHeader.jsx**
- ✅ 로그인 정보에 관리자 배지 추가
- ✅ 원래 관리자: "관리자" 표시
- ✅ 대리 관리자: "대리" 표시

**화면 예시:**
```
[사용자 아바타] 박세인 [관리자]
                    IT개발팀
```

---

## 🗂️ **수정된 파일 목록**

### 📁 백엔드
```
backend/
└── AdminDelegationController.java  ✅ 헤더 optional + 샘플 데이터
```

### 📁 프론트엔드
```
frontend/
├── NoticeApproval.jsx               ✅ 버튼 통합
├── NoticeApproval_styles.css        ✅ 클릭 가능 버튼 스타일
├── AppHeader.jsx                    ✅ 관리자 배지 추가
└── AppHeader_styles.css             ✅ 배지 스타일
```

---

## 🚀 **설치 가이드 (v2)**

### 1️⃣ 백엔드 파일 교체

**위치:**
```
temp/app-api/src/main/java/kr/co/koreazinc/app/controller/v1/admin/
└── AdminDelegationController.java  (기존 파일 덮어쓰기)
```

### 2️⃣ 프론트엔드 파일 교체

#### **NoticeApproval 페이지**
```
temp/react-app/src/pages/
├── NoticeApproval.jsx  (기존 파일 덮어쓰기)
└── NoticeApproval.css  (끝에 NoticeApproval_styles.css 내용 추가)
```

**NoticeApproval.css 업데이트 방법:**
```bash
# 기존 NoticeApproval.css 파일 끝에 추가
cat NoticeApproval_styles.css >> NoticeApproval.css
```

#### **AppHeader 컴포넌트**
```
temp/react-app/src/components/
├── AppHeader.jsx  (기존 파일 덮어쓰기)
└── AppHeader.css  (끝에 AppHeader_styles.css 내용 추가)
```

**AppHeader.css 업데이트 방법:**
```bash
# 기존 AppHeader.css 파일 끝에 추가
cat AppHeader_styles.css >> AppHeader.css
```

---

## 📸 **UI 스크린샷 (예상)**

### **1. NoticeApproval 페이지**
```
┌─────────────────────────────────────────────┐
│ 공지 발송 결재                               │
│ [관리자 위임 버튼] ← 클릭 가능               │
└─────────────────────────────────────────────┘
```

### **2. AppHeader (관리자)**
```
┌────────────────────────────────────────────────┐
│  [로고] 공지관리 시스템  [메뉴...]             │
│                  [👤 박세인 [관리자] IT개발팀]   │
└────────────────────────────────────────────────┘
```

### **3. AppHeader (대리 관리자)**
```
┌────────────────────────────────────────────────┐
│  [로고] 공지관리 시스템  [메뉴...]             │
│                  [👤 박경민 [대리] 경영지원팀]   │
└────────────────────────────────────────────────┘
```

---

## 🧪 **테스트 시나리오 (v2)**

### 시나리오 1: HR150138 권한자 (성공 케이스)
1. ✅ HR150138 권한으로 로그인
2. ✅ 헤더에 "관리자" 배지 표시 확인
3. ✅ 승인 화면에서 "관리자 위임" 버튼 표시
4. ✅ 버튼 클릭 시 모달 오픈
5. ✅ 대리 관리자 선택 및 생성
6. ✅ 위임 목록에 표시 (샘플 데이터 or 실제 데이터)

### 시나리오 2: 일반 사용자
1. ✅ 일반 사용자로 로그인
2. ✅ 헤더에 관리자 배지 없음
3. ✅ 승인 화면에서 "관리자 위임" 버튼 없음
4. ✅ 승인/반려 버튼 비활성화

### 시나리오 3: X-User-Id 헤더 없음 (에러 방지)
1. ✅ 헤더 없이 `/v1/api/admin/delegations/my` 호출
2. ✅ 500 에러 대신 샘플 데이터 반환
3. ✅ 모달 정상 오픈
4. ✅ 샘플 위임 목록 2개 표시

---

## ⚡ **핵심 개선 사항**

### 백엔드
```java
// ❌ 수정 전 - 헤더 필수, 없으면 500 에러
@RequestHeader("X-User-Id") String userId

// ✅ 수정 후 - 헤더 optional, 없으면 샘플 데이터
@RequestHeader(value = "X-User-Id", required = false) String userId

if (userId == null || userId.isEmpty()) {
    return ApiResponse.success(getSampleDelegations());
}
```

### 프론트엔드
```jsx
// ❌ 수정 전 - 버튼 2개
<div className="admin-badge">관리자 권한</div>
<button className="btn-delegation">권한 위임</button>

// ✅ 수정 후 - 버튼 1개 (클릭 가능)
<div 
  className="admin-badge clickable"
  onClick={() => setShowDelegationModal(true)}
>
  관리자 위임
</div>
```

---

## 📝 **추가 개발 필요 사항**

1. **Axios Interceptor** - HTTP 헤더 자동 추가
   ```javascript
   // apiClient.js
   apiClient.interceptors.request.use(config => {
     const userInfo = JSON.parse(sessionStorage.getItem('user_me'));
     if (userInfo) {
       config.headers['X-User-Id'] = userInfo.userId;
       config.headers['X-User-Name'] = userInfo.userNm;
     }
     return config;
   });
   ```

2. **SSO API 연동** - AdminUsersController의 샘플 데이터 대체

3. **실시간 권한 갱신** - 위임 생성/삭제 후 헤더 배지 즉시 업데이트

---

## 🎉 **완료!**

모든 파일이 업데이트되었습니다. 

### 빠른 적용 체크리스트:
- [ ] ✅ AdminDelegationController.java 교체
- [ ] ✅ NoticeApproval.jsx 교체
- [ ] ✅ NoticeApproval.css 스타일 추가
- [ ] ✅ AppHeader.jsx 교체
- [ ] ✅ AppHeader.css 스타일 추가
- [ ] ✅ 빌드 & 재시작
- [ ] ✅ 테스트 (HR150138 권한자로 로그인)

**문의사항이 있으시면 언제든지 말씀해주세요!** 🚀
