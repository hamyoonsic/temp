/sso-redirect ê°€ 401 Unauthorized ë‚˜ëŠ” ì§„ì§œ ì´ìœ 

ìš”ê²Œ ì§€ê¸ˆ í•µì‹¬ì´ì•¼.

ë¸Œë¼ìš°ì € ì •ë³´:

Request URL: http://172.20.80.224:5173/sso-redirect?code=...
Status Code: 401 Unauthorized


ì¦‰:

SSO ì„œë²„ê°€ code=... ë‹¬ì•„ì„œ ìš°ë¦¬ ì„œë²„ /sso-redirectë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•´ ì¤¬ëŠ”ë°

ê·¸ /sso-redirectë¥¼ Spring Securityê°€ â€œì¸ì¦ ì•ˆ ëë„¤?â€ í•˜ê³  401ë¡œ íŠ•ê¹€

ì™œëƒë©´, ì§€ê¸ˆ WebSecurityConfigê°€ ì´ë ‡ê²Œ ë¼ ìˆê±°ë“  ğŸ‘‡

.requestMatchers("/swagger-ui/**", "/api-docs/**").permitAll()
.requestMatchers("/", "/index.html", "/assets/**", "/*.svg", "/*.ico").permitAll()
.anyRequest().access(accessChecker);


ì—¬ê¸°ì„œ ì¤‘ìš”í•œ í¬ì¸íŠ¸:

/sso-redirect ê²½ë¡œê°€ permitAllì— ì—†ìŒ

ê·¸ë˜ì„œ /sso-redirect?... ìš”ì²­ë„ anyRequest().access(accessChecker)ë¥¼ íƒ€ê²Œ ë¨

ê·¸ëŸ°ë° ì´ ìˆœê°„ì€ ì•„ì§ ë¡œê·¸ì¸ ì „ì´ë¼ í† í° ì—†ìŒ

TokenAuthenticationFilter ì…ì¥ì—ì„  Authorization í—¤ë”ë„ ì—†ìŒ

â†’ accessCheckerê°€ â€œì´ ì‚¬ëŒ ì¸ì¦ ì•ˆ ëëŠ”ë°?â€ â†’ 401

ì¦‰, êµ¬ì¡°ë¥¼ ë¬¸ì¥ìœ¼ë¡œ ë§í•˜ë©´:

SSOê°€ ìš°ë¦¬ ì„œë¹„ìŠ¤ì— codeë¥¼ ì£¼ë ¤ê³  ë”± ë“¤ì–´ì™”ëŠ”ë°,
ì •ì‘ ìš°ë¦¬ Spring Securityê°€ â€œë„ˆ ëˆ„êµ¬ì•¼?â€ í•˜ë©´ì„œ ë¬¸ ì•ì—ì„œ ë‚´ì«“ëŠ” ìƒí™© ğŸ˜‚

Reactì˜ SSORedirect.jsxê¹Œì§€ ë„ë‹¬ë„ ëª» í•˜ê³ , Spring Security ê´€ë¬¸ì—ì„œ ë§‰íˆê³  ìˆëŠ” ê±°ì•¼.

í•´ê²°: /sso-redirectë¥¼ â€œìµëª… ì ‘ê·¼ í—ˆìš© + SPA í¬ì›Œë”©â€ ìœ¼ë¡œ ì—´ì–´ì£¼ê¸°
â‘  Securityì—ì„œ /sso-redirectë¥¼ permitAllë¡œ ì¶”ê°€

WebSecurityConfig ìˆ˜ì •:

security.authorizeHttpRequests(request -> CoreSecurityConfigurerAdapter.Request
        .init(request)
        .requestMatchers("/swagger-ui/**", "/api-docs/**").permitAll()
        .requestMatchers(
            "/", 
            "/index.html", 
            "/assets/**", 
            "/*.svg", 
            "/*.ico",
            "/sso-redirect",      // â† ì¶”ê°€
            "/sso-redirect/**"    // â† íŒ¨í„´ê¹Œì§€ ì—´ì–´ë‘ë©´ ë” ì•ˆì „
        ).permitAll()
        .anyRequest().access(accessChecker)
);


ì´ë ‡ê²Œ í•˜ë©´:

/sso-redirect?code=... ìš”ì²­ì€
â†’ í† í° ì—†ì–´ë„ ì ‘ê·¼ í—ˆìš©
â†’ React index.htmlê¹Œì§€ ë„ë‹¬ ê°€ëŠ¥

â‘¡ IndexControllerì—ì„œë„ /sso-redirectë¥¼ SPA ê²½ë¡œë¡œ ì¶”ê°€

ì§€ê¸ˆ IndexControllerëŠ” ëŒ€ëµ ì´ë ‡ê²Œ ìƒê²¼ì§€?

@Slf4j
@Controller
public class IndexController {

    @GetMapping("/")
    public String root() {
         log.info(">>> [ROOT IndexController] SPA ìš”ì²­ ë“¤ì–´ì˜´");
        return "forward:/index.html";
    }

    @GetMapping({
        "/notices/**",
        "/dashboard/**", 
        "/approval/**",
        "/calendar/**"
    })
    public String spa() {
        return "forward:/index.html";
    }
}


ì—¬ê¸°ì— /sso-redirectë„ ì¶”ê°€í•´ ì¤˜ì•¼ React ë¼ìš°í„°ê°€ ì´ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ ğŸ‘‡

    @GetMapping({
        "/notices/**",
        "/dashboard/**", 
        "/approval/**",
        "/calendar/**",
        "/sso-redirect/**"   // â† ì¶”ê°€
    })
    public String spa() {
        return "forward:/index.html";
    }


ì´ë ‡ê²Œ ë˜ë©´ ì „ì²´ íë¦„ì´:

ì‚¬ìš©ì â†’ AUTH ì„œë²„ ë¡œê·¸ì¸

AUTH ì„œë²„ â†’ http://172.20.80.224:5173/sso-redirect?code=...ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

Spring Security

/sso-redirectëŠ” permitAllì´ë¼ í†µê³¼

IndexController
/sso-redirect ë§¤í•‘ â†’ forward:/index.html
React index.html ë¡œë“œ
React Routerê°€ /sso-redirect â†’ <SSORedirect /> ì»´í¬ë„ŒíŠ¸ ë Œë”

SSORedirect.jsxê°€ codeë¥¼ ì½ê³ 
/v2/oauth/token í˜¸ì¶œ
access_token ë°›ìŒ
sessionStorageì— ì €ì¥
ì´í›„ API ì ‘ê·¼ ì‹œ Authorization í—¤ë” ë¶™ì´ê³  í˜¸ì¶œ
ê·¸ ë‹¤ìŒë¶€í„° /api/** ìš”ì²­ì€ TokenAuthenticationFilter + accessCheckerë¥¼ ì •ìƒ í†µê³¼